#!/usr/bin/env bash

# System Message Of The Day
# (SMOTD)

version=0.1

# Parts of this has been taken from neofetch. https://github.com/dylanaraps/neofetch
# This is a customised motd with less built-in than neofetch
# ┌──────────────────────────────────────┐ 
# │                                      │░
# │            SOURCE CONFIG             │░
# │                                      │░
# └──────────────────────────────────────┘░
#  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
. ./config.conf

# ┌──────────────────────────────────────┐ 
# │                                      │░
# │           SOURCE CONSTANTS           │░
# │                                      │░
# └──────────────────────────────────────┘░
#  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
. ./constants/colours
. ./constants/bar

# ┌──────────────────────────────────────┐ 
# │                                      │░
# │           PLUGINS TO RUN             │░
# │                                      │░
# └──────────────────────────────────────┘░
#  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
plugins()
{

    PLUGINS=(

        # Essentially Ordered Plugins.
        "kernel"        # KERNAL MUST BE FIRST PLUGIN. (OS Relies on it)
        "os"            # OS MUST BE THE SECOND PLUGIN. (Others rely on it)

        # All other Plugins
        "hostname"
        "local_ip"
        "public_ip"
        "uptime"
        "cpu_usage"
        "memory"
        "disk"
        "model"
        "systemctl:mysql"   
        "systemctl:php"   
        "systemctl:apache"   
        "systemctl:ssh"   
        "puppet"
        "logo"
    )


    # ┌──────────────────────────────────────┐ 
    # │        Source & Run Plugins          │
    # └──────────────────────────────────────┘
    for plugin in "${PLUGINS[@]}"; do

        IFS=: read plugin_name plugin_parameter <<< $plugin

        filename="get_${plugin_name}"               # Filename
        . ./plugins/$filename                       # Source File
        $filename $plugin_parameter  /dev/null   # Run, hide errors
    done

}
plugins


# ┌──────────────────────────────────────┐ 
# │                                      │░
# │              VARIABLES               │░
# │                                      │░
# └──────────────────────────────────────┘░
#  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
WIDTH=$(tput cols)




# Make the line 80chars long, no matter the title length.
title(){

    TITLE=$1
    COUNT=${#TITLE}
    let "LENGTH = (80-$COUNT)/2"
    for ((i=1; i<=$LENGTH; i++)); do
        printf "${I_Black}-"
    done

    printf "${Red} $TITLE "

    for ((i=1; i<=$LENGTH; i++)); do
        printf "${I_Black}-"
    done
    
    printf "\n"
}



# LOGO

output_node()
{
    # NODE
    printf "${LOGO}\n"
    title "${HOSTNAME}"
    printf "${I_Black}HOST: ${Cyan}%-40s ${I_Black} UP  : ${Cyan}%-40s\n" "${HOSTNAME}"       "${UPTIME}"
    printf "${I_Black}OS  : ${Cyan}%-40s ${I_Black} CPU : ${Cyan}%-40s\n" "${OS}"             "${CPU_USAGE}"
    printf "${I_Black}PUB : ${Cyan}%-40s ${I_Black} HDD : ${Cyan}%-40s\n" "${LOCAL_IP}"       "${DISK}"
    printf "${I_Black}PRI : ${Cyan}%-40s ${I_Black} MEM : ${Cyan}%-40s\n" "${PUBLIC_IP}"      "${MEMORY}"
    printf "${I_Black}- : ${Cyan}%-54s ${I_Black} MOD : ${Cyan}%-40s\n" "-"      "${MODEL}"
}

output_services()
{
    # SERVICES
    title "Services"
    printf "${I_Black}PHP : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${MYSQL}"    
    printf "${I_Black}MSQL: ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${PHP}" 
    printf "${I_Black}WEB : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${APACHE}" 
    printf "${I_Black}SSH : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${SSH}"
    printf "${I_Black}RAN : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${PUPPET_LASTRAN}"
    printf "${I_Black}LOC : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${PUPPET_LOCKED}"
    printf "${I_Black}TXT : ${Cyan}%-40s ${I_Black}  :${Green} %-40s\n" "${PUPPET_MESSAGE}"
    
}

helpme(){
    title "Help"
    printf "${I_Black}HELP: ${Orange}'help' will list custom scripts. 'cheat' for command cheatsheet.\n"
}

output_node;
output_services;
# helpme;
# title "◣◥";